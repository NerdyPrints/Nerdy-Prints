document.addEventListener('DOMContentLoaded', async () => {
    const container = document.getElementById('product-container');

    try {
        const response = await fetch('https://api.printful.com/sync/products', {
            method: "GET",
            headers: {
                "Authorization": "Bearer I3rUXUDVvQRxC9eedtBPzud02LeW5gIPP76qzvGgULmO3EENwcvSzNllwVZp96ud",
                "Content-Type": "application/json"
            }
        });

        const data = await response.json();
        console.log("Printful API Response:", data); // Debugging: check if products are fetched

        if (data && data.result && Array.isArray(data.result)) {
            container.innerHTML = '';
            data.result.forEach(product => {
                console.log("Product Data:", product); // Debugging: check individual products
                const productName = product.name || "Unnamed Product";
                const productImage = product.thumbnail_url ? product.thumbnail_url : "https://via.placeholder.com/300x300?text=No+Image";
                
                const div = document.createElement('div');
                div.classList.add('product-card');
                div.innerHTML = `
                    <img src="${productImage}" alt="${productName}">
                    <h3>${productName}</h3>
                    <a href="/customize.html?product_id=${product.id}&title=${encodeURIComponent(productName)}&image=${encodeURIComponent(productImage)}">Customize</a>
                `;
                container.appendChild(div);
            });
        } else {
            console.error("No products available:", data);
            container.innerHTML = '<p>No products available</p>';
        }
    } catch (error) {
        console.error("Error fetching products:", error);
        container.innerHTML = '<p>Error loading products</p>';
    }
});
